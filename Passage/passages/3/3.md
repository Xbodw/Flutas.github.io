# 使用汇编生成MBR并使用C#修改

by ![Xbodw]([https://p3-pc-sign.douyinpic.com/aweme/100x100/aweme-avatar/tos-cn-i-c9aec8xkvj_013376ac0c4a444ab591499fb7288575.jpeg?x-expires=1706418000&x-signature=lDCDrCItt9Op5OHuXI1r6MP%2FSqo%3D&from=2480802190])

该文章遵循 [Attribution-NonCommercial 4.0 International]()许可协议.

## 前言

之前我分享了一个使用[Csharp(简称C#,后文用此称)](https://learn.microsoft.com/zh-cn/dotnet/csharp/tour-of-csharp/)修改[MBR](https://baike.baidu.com/item/%E4%B8%BB%E5%BC%95%E5%AF%BC%E8%AE%B0%E5%BD%95/7612638)的方法,但是,MBR是由不同进制的字符组成的,我们想要让MBR~~变成
硬盘逻辑锁~~ 显示 我们想要的字符串该怎么办？
   
   修改MBR教程链接 [016281261](?id=016281261)

该操作极其危险,需要对电脑及其熟练的人才能操作,建议在虚拟机内运行,否则,后果自负!

## 开始之前

不知大家是否知道世界上的几大电脑病毒,其中比较恐怖的有 Windows XP horror Edition.用网上简洁一点的话说,该病毒涵盖了以下几个特征:
 1.伪装成XP升级包
 
 2.运行后改注册表
 
 2.运行后改[MBR](#前言)
 
 3.修改系统文件,常见的有 666.sys

 4.进度达`66%`的时候原本伪装的XP升级界面界面变红

 5.界面变红后出现几大恐怖节目

给大家看一下该病毒改完MBR后的效果图:

![XP Horror Edition的效果图]([https://ts3.cn.mm.bing.net/th?id=OIP-C.OiD8YLDkDHFoGrBmT0D4SwHaEo&w=316&h=197&c=8&rs=1&qlt=90&o=6&pid=3.1&rm=2])

这就是通过修改MBR实现的.想要改这样的MBR不是一件简单的事.

## 准备工作

前往 [NASM官网(2.16.01下载链接)](https://www.nasm.us/pub/nasm/releasebuilds/2.16.01/win64/nasm-2.16.01-installer-x64.exe) 下载NASM.
使用汇编语言这种底层语言修改MBR是比较简单的事情.

下载完之后打开安装程序,无脑点击Next 下一步即可,安装完成后创建一个空目录.

使用资源管理器打开刚才的空目录,在地址栏键入 `cmd` 并回车,打开命令提示符.

输入`nasm --version`查看版本号,确保nasm没有报错后进行下一步.

在这个空目录里新建MBR.asm,使用Notepad++等专业工具打开,在里面输入以下内容并保存.
```asm
    org 07c00h          ; 使其加载到7c00处
    mov ax, cs
    mov ds, ax
    mov es, ax
    call    DispStr         ; 调用显示字符串例程
    jmp $          ; 无限循环显示
DispStr:
    mov ax, BootMessage
    mov bp, ax          ; ES:BP = 串地址
    mov cx, 16          ; CX = 串长度
    mov ax, 01301h      ; AH = 13,  AL = 01h
    mov bx, 000ch       ; 页号为0(BH = 0) 黑底红字(BL = 0Ch,高亮)
    mov dl, 0
    int 10h         ; 10h 号中断
    ret
BootMessage:        db  "Your computer is broken"
times   510-($-$$)   db  0   ; 填充剩下空间为512B
dw  0xaa55
```
保存后在打开的命令提示符内输入 `nasm MBR.asm -o MBR.bin`(可以不带 .bin扩展名)

随后在命令提示符内输入
```batch
echo= > boot.img
```
打开 [FloppyWriter](https://raw.githubusercontent.com/huangyingw/FloppyWriter/master/Release/FloppyWriter.exe)(需要先登录Github),点击 `Write FIle to Image`,选择刚才生成的MBR文件,然后会弹出第二个选择框,选择boot.img.

此时如果弹出 成功,表示操作成功.

随后我们可以打开Vmware WorkStation,选择任意虚拟机(创建虚拟机网上有教程,此处不再赘述),点击 "编辑虚拟机设置",


![添加硬件](https://img2.imgtp.com/2024/01/27/t3DmTfqI.png)

再点击"添加(A)",


![选择硬件类型](https://img2.imgtp.com/2024/01/27/CRvXhzMk.png)

选择”软盘驱动器"


![选择软盘加载方式](htps://img2.imgtp.com/2024/01/27/wjmfvEjm.png)

再选择“使用软盘镜像文件",点击浏览,


![浏览boot.img](https://img2.imgtp.com/2024/01/27/VLyaOS3C.png)

选择boot.img镜像并点击确定,随后可以启动虚拟机查看文字效果.

![最终演示效果](https://img2.imgtp.com/2024/01/27/qAtJgI41.png)

上述代码由于字节过长,文字显示不全只能显示 "you computer is",需要把文字搞短一点点.使用MBR只能显示很短的文字,可以使用EFI显示文字.后续可能会出如何编写EFI显示文字的教程.






 
