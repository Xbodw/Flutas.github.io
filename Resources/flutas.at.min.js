var at = {};
at.AddCodeCopy = async function() {
  // 获取所有代码块元素
  const codeBlocks = document.querySelectorAll("pre");
  let CodeBlk = $('.copy-button');
  if(CodeBlk != null) {
    await CodeBlk.remove();
  }
  if(codeBlocks.length > 0) {
  await codeBlocks.forEach((codeBlock, index) => {
    // 创建复制按钮元素
    const copyButton = document.createElement("span");
    copyButton.classList.add("copy-button");
    copyButton.textContent = '复制代码';
    // 为按钮添加点击事件监听器
    copyButton.addEventListener("click", () => {
      // 获取代码内容
      copyButton.textContent = '';
      const codeContent = codeBlock.querySelector("code").innerText;
      // 创建临时textarea元素
      const textarea = document.createElement("textarea");
      textarea.value = codeContent;
      document.body.appendChild(textarea);
      // 选中textarea内容
      SureCopy = true; //临时允许复制
      textarea.select();
      textarea.setSelectionRange(0, 99999);

      // 复制内容到剪贴板
      document.execCommand("copy");
      copyButton.textContent = copyButton.parentElement.childNodes[0].className.split('-')[1].replace(/hljs/g, '').replace(/language/g, '') + ' 复制成功';
      // 删除临时元素
      document.body.removeChild(textarea);
      setTimeout(() => {
        copyButton.textContent = copyButton.parentElement.childNodes[0].className.split('-')[1].replace(/hljs/g, '').replace(/language/g, '') + ' 复制代码';
      }, 1500);
    });

    codeBlock.appendChild(copyButton);
    copyButton.textContent = copyButton.parentElement.childNodes[0].className.split('-')[1].replace(/hljs/g, '').replace(/language/g, '') + ' 复制代码';
  });
  }
}
